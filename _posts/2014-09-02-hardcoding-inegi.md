---
layout: post
title: Hardcoding. Basura para unos, tesoro para otros.
category: web scraping
tags: [hardcoding, web scraping, inegi]
published: false
---

Hace más de un año que doy clases de programación en la [UANL](http://www.uanl.mx/). Me resulta bastante interesante por un muchas razones <del>bastantes cursis</del> que por el momento prefiero omitir. Durante este tiempo, me he dado cuenta como aprenden diferentes tipos de personas. He encontrado perfiles de todo tipo; desde los que necesitan una guía paso a paso, hasta los que se adelantan en los temas todo el tiempo.

Durante las clases, generalmente insisto bastante en aspectos teóricos tratando de no descuidar lo práctico. Sin embargo, hay quienes insisten en que lo teórico es poco relevante y deciden omitir mucha información para llegar a la práctica sin ver un poco la teoría. No pienso que sea algo malo, me parece una manera perfecta de aprender, el aprender con el hacer... pero tampoco hay que exagerar.

[caption id="attachment_354" align="alignleft" width="500"]<img style="border:none !important;" class="wp-image-354 size-large" src="https://mikengine.files.wordpress.com/2014/09/khancoding.jpg?w=500" alt="Image: stevenchasestudios.com" width="500" height="168" /> Image: stevenchasestudios.com[/caption]

...No vengo a escribir sobre mis <del>extraños</del> métodos de enseñanza. El asunto aquí, es sobre los usos del lenguaje y/o herramientas, hasta la aplicación que se les da. No quiero que este post haga parecer que estoy criticando a otros desarrolladores o aquellos que empiezan (o empezamos) en algún lenguaje o framework en particular. Nada de lo anterior, solo quiero hacer énfasis en lo que debe ser tratado con cuidad... En fin, mi entrada viene motivada por la siguiente triste historia...

Ya hace tiempo que tenía *la espinita* de construir un [crawler / web spider](http://en.wikipedia.org/wiki/Web_crawler). Algunos de los temas que llaman mucho mi atención, están relacionados con el tratamiento de la información que se obtiene de los censos y demás. Así que pensé en hacerle [scrapping](http://en.wikipedia.org/wiki/Web_scraping) al sitio del [INEGI](http://www.inegi.org.mx/).

Comencé mi noche evaluando la información y <i> <a style="text-decoration:none;" href="http://pixabay.com/static/uploads/photo/2010/11/29/india-299_640.jpg" target="_blank">despiojando</a> </i> url's, variando los parámetros; únicamente con la finalidad de evaluar la idea del scrapper. Comencé intentando con información económica. </p>
<a href="http://mikengine.files.wordpress.com/2014/09/inegiurl.png" target="_blank"><img src="http://mikengine.files.wordpress.com/2014/09/inegiurl.png" alt="inegiurl" width="500" height="304" class="aligncenter size-full wp-image-370" /></a>
<p style="font-size:18px;">Hasta aquí parece que puede funcionar, los parámetros de la url no están encriptados y al enviar números al azar, arroja diferentes tablas. Es un buen comienzo.</p>
<p style="font-size:18px;">Luego, investigo sobre los censos económicos del 2009; aquí parece haber una <i><a style="text-decoration:none;" href="http://en.wikipedia.org/wiki/Capirotada" target="_blank">capirotada</a></i> de tecnologías. Dentro de cada página hay muchos frames y archivos <code style="background-color:#eee;border-radius:3px;padding:3px;font-size:14px;">swf</code> embebidos, es decir, mucho flash.</p>
<a href="http://mikengine.files.wordpress.com/2014/09/inegiswf.png" target="_blank"><img src="http://mikengine.files.wordpress.com/2014/09/inegiswf.png" alt="inegiswf" width="500" height="303" class="aligncenter size-full wp-image-371" /></a>
<p style="font-size:18px;">Para el caso de flash, se puede utilizar cualquier herramienta web para decodificar cada archivo y ver el contenido de las funciones. Dado que solo quiero indagar, utilizo <a style="text-decoration:none;" href="http://www.showmycode.com/" title="showmycode" target="_blank">ShowMycode</a>; una herramienta que me acabo de encontrar por ahí. Supongo que el contenido de este archivo en flash está al mismo nivel de la ruta de la página; en su mayoría son funciones que apuntan a recursos excel.</p>
<a href="http://mikengine.files.wordpress.com/2014/09/inegiswfdecoded.png" target="_blank"><img src="http://mikengine.files.wordpress.com/2014/09/inegiswfdecoded.png" alt="inegiswfdecoded" width="500" height="392" class="aligncenter size-full wp-image-372" /></a>
<p style="font-size:18px;"> Yo sigo jugando con la página. Así como archivos físicos, veo que también hay algunas opciones para exportar a <code style="background-color:#eee;border-radius:3px;padding:3px;font-size:14px;">xlsx</code>. Descargo un par de ellos, para comparar la información con la de la página. Pienso que quizá sea útil descargar automáticamente los archivos. Un mágico <code style="background-color:#eee;border-radius:3px;padding:3px;font-size:14px;">wget</code> sería suficiente, pero aquí estaría en función del servidor web y la protección que le dá este último a los directorios; aunque es mas que obvio que se trata de un IIS, podemos ver los headers. </p>
<a href="http://mikengine.files.wordpress.com/2014/09/inegiserver.png" target="_blank"><img src="http://mikengine.files.wordpress.com/2014/09/inegiserver.png" alt="inegiserver" width="500" height="163" class="aligncenter size-full wp-image-373" /></a>
<p style="font-size:18px;">Sin embargo, hacer un hack y <i>saltarse</i> por ahí, es otro tema. Entonces... mejor ver el HTML que <del>escupe</del> arroja alguno de los enlaces que están ligados al post de los botones de exportar, para ir directo a los recursos; además ya he sacado bastante, algo más interesante debo encontrar.</p>
<blockquote style="background-color:#f8f8f8;font-size:1.5em;padding:0 0 0 10px;">No quiero alargar el post, dejaré para otra entrada el tema del scrapper... </blockquote>
<p style="font-size:18px;">En fin, navegando entre páginas y escarbando el HTML, me encuentro <a href="http://www.inegi.org.mx/est/contenidos/espanol/proyectos/censos/ce2009/saic/exportar.asp?Cuadro=INEGI.+Censos+Econ%C3%B3micos+2009.+Resultados+definitivos&amp;Censo=2009&amp;Nacional=&amp;vcampo=H001A&amp;Sector=23&amp;c=17166&amp;Genera=1&amp;formato=Hoja+de+C%C3%A1lculo+Excel%28.xls%29&amp;Modelo=SCIAN&amp;Grupo=AA&amp;Municipio=01001" target="_blank">esta url que descarga en automático un archivo excel;</a> la página que resulta de la url, visualmente está en blanco y sin contenido, solo nos descarga el archivo. Lo interesante es que no apunta directamente a un recurso de tipo excel, si no a uno de HTML. Desde ya, es algo que debe ser inspeccionado. </p>
<a href="http://mikengine.files.wordpress.com/2014/09/inegi-e1409723652300.png" target="_blank"><img src="http://mikengine.files.wordpress.com/2014/09/inegi-e1409723652300.png" alt="inegi" width="500" height="177" class="aligncenter size-full wp-image-374" /></a>
<p style="font-size:18px;">WTF?!!. No solo hay consultas SQL en hiddens, también una cadena de conexión!. <i>- Estos si que son unos loquillos -</i>. HTML <b>no</b> es para almacenar ese tipo de información, esto debería estar escrito en otro lugar. No sé cual sea la razón de hacerlo de esa manera. </p>
<p style="font-size:18px;">Y?... honestamente no tengo interés en conectarme a la base de datos. No lo he hecho ni lo haré, es algo bastante trivial y de cualquier forma no me serviría para nada. Por otra parte, me he dado cuenta que ya existe una <a style="text-decoration:none;" href="http://www.inegi.org.mx/inegi/contenidos/serviciosWEB/" target="_blank">API</a> para consumir <i>legalmente</i> los datos, asi que poco a poco pierdo el interés en hacer un scrapper para esto.</p>

<blockquote style="background-color:#f8f8f8;font-size:1.5em;padding:0 0 0 10px;">
-By the way-, encontré este proyecto: <a style="text-decoration:none;" href="http://inegifacil.com/" target="_blank"> INEGI Fácil</a>, que me ha parecido bastante interesante. </blockquote>

<p style="font-size:18px;">En definitiva, todo esto se trata de crítica constructiva. No me malinterpreten. También, debo hacer saber que toda esta información es pública, llega a mi navegador y en ningún momento estoy dentro de algún lugar protegido o lo que sea. </p>
<p style="font-size:18px;">Mi intención y mensaje, es que se debe tomar muy en cuenta que para algunos puede no importar, pero habrá quienes sacarán el mayor provecho de estas malas prácticas y mal uso de los lenguajes y/o herramientas. Es por esto que en ocasiones es importante conocer un mínimo suficiente de teoría.</p>
